# Singletonパターン

### Singleton パターン（シングルトン・パターン）とは、オブジェクト指向のコンピュータプログラムにおける、デザインパターンの1つである。GoF (Gang of Four; 4人のギャングたち) によって定義された。Singleton パターンとは、そのクラスのインスタンスが1つしか生成されないことを保証するデザインパターンのことである。ロケールやルック・アンド・フィールなど、絶対にアプリケーション全体で統一しなければならない仕組みの実装に使用される([wikipediaより](https://ja.wikipedia.org/wiki/Singleton_%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3))

- Webシステムではあまり使用されない
    - Webシステム自体が分散システムのため
        - Webサーバーが複数台あったりすると逆にSingletonにすると大変なのでは？
    - [Object Poolパターン](https://en.wikipedia.org/wiki/Object_pool_pattern)のほうがよく使われている
        - データベースのコネクションへの確立には時間がかかるため、コネクションプールを使用して接続を再利用する
            - ※接続した状態を用意してそれを使い回す

<br>

- 利用されているところ
    - スマホアプリ（基本的に動いているプロセスが１つのため）ではよく利用されている
        - データストアのコネクションはSingletonで書かれていることが多い
            - ※データストアのコネクションは処理が重いため、何回も実行されないようにするため
    - 時間を測る処理
        - 処理時間を管理するようなクラス（ストップウォッチみたいな機能）で使用されているところを見たことがある
        - Webアプリの場合、Timeサーバーを使用するべきだがデスクトップアプリなどはこういうクラスを使用するのもありでは
            - Webアプリだとサーバー間で時間が違ってくる場合があるので時間だけを管理しているサーバーを使用するべき

<br>

- スレッドセーフについて
    - Singletonパターンを適用する時、スレッドセーフになるよう注意すること
    - 同時に実行したら必ずインスタンスが1つになる保障がないようなものはダメ！！

<br>

- その他
    - PHPで書けなかった記述
        ```php
        private static $instance = New Singleton;
        ```

        下記のようなエラーが出て記述出来なかった(Javaではこのような形で記述されていた)
        ```
        PHP Fatal error:  Constant expression contains invalid operations in C:\Project\phpDesignPattern\Singleton\main.php on line 6
        ```

- 出力結果

```
Start.
インスタンスを生成しました
obj1とobj2は同じインスタンスです
End.
```
